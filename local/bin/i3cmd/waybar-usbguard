#!/bin/sh

listen() {
  blocked="$(usbguard list-devices -b | head -n1 | grep -Po 'name "\K[^"]+')"
  if [ -n "$blocked" ]; then
    printf '{"text": "ïŠ‡  %s"}\n' "$blocked"
  else
    printf '{"text": ""}\n'
  fi
}

allow() {
  blocked_id="$(usbguard list-devices -b | head -n1 | grep -Po '^[^:]+')"
  usbguard allow-device "$blocked_id"
}

reject() {
  blocked_id="$(usbguard list-devices -b | head -n1 | grep -Po '^[^:]+')"
  usbguard reject-device "$blocked_id"
}

if [ "$1" = "allow" ]; then
  allow
elif [ "$1" = "reject" ]; then
  reject
else
  listen
fi
